<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Soul</title>
    <!-- TailwindCSS Configuration -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<style>
    :root {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    /* Custom scrollbar for chat messages */
    .chat-messages::-webkit-scrollbar {
        width: 5px;
    }

    .chat-messages::-webkit-scrollbar-track {
        background: transparent;
    }

    .chat-messages::-webkit-scrollbar-thumb {
        background: oklch(37.9% 0.146 265.522);
    }
</style>

<body class="flex items-center justify-center h-screen bg-blue-100 w-full p-10">
    <div class="flex flex-col w-3/5 rounded-xl overflow-hidden h-full shadow-lg shadow-blue-900 bg-blue-200">
        <h1 class="p-4 text-blue-900 text-center text-4xl font-bold border-b-2 border-blue-900">Cosmic Soul</h1>
        <!-- Chat Messages Display Area -->
        <div id="chat-messages" class="chat-messages flex-1 p-6 space-y-4 overflow-y-auto">
            <!-- Messages will be dynamically added here -->
            <div class="flex justify-start">
                <div class="bg-blue-200 text-blue-900 p-3 rounded-lg max-w-xs md:max-w-md shadow-lg shadow-blue-900">
                    <p>Welcome to the chat! Type a message below.</p>
                    <span class="text-xs text-slate-900 mt-1 block text-right">Just now</span>
                </div>
            </div>
            <div class="flex justify-end">
                <div class="bg-blue-100 text-blue-900 p-3 rounded-lg max-w-xs md:max-w-md shadow-lg shadow-blue-900">
                    <p>This is an example of a sent message.</p>
                    <span class="text-xs text-slate-900 mt-1 block text-right">Just now</span>
                </div>
            </div>
        </div>
        <!-- Message Input Area -->
        <div class="p-4 border-t-2 border-blue-900">
            <div class="flex items-center space-x-3">
                <input type="text" id="message-input" placeholder="Type your message..."
                    class="flex-1 p-3 bg-blue-100 rounded-lg focus:outline-none text-blue-900 inset-shadow-sm inset-shadow-blue-900">
                <button id="send-button"
                    class="bg-blue-900 hover:bg-blue-950 text-blue-100 font-semibold cursor-pointer py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75">
                    Send
                </button>
            </div>
        </div>
    </div>

    <script>
        // Get references to DOM elements
        const chatMessages = document.getElementById('chat-messages');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');

        // Function to format time
        function formatTime(date) {
            let hours = date.getHours();
            let minutes = date.getMinutes();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; // The hour '0' should be '12'
            minutes = minutes < 10 ? '0' + minutes : minutes;
            return `${hours}:${minutes} ${ampm}`;
        }

        // Function to add a message to the chat display
        function addMessage(message, isUser = true) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('flex', isUser ? 'justify-end' : 'justify-start');

            const messageBubble = document.createElement('div');
            messageBubble.classList.add(
                'p-3',
                'rounded-lg',
                'max-w-xs',
                'md:max-w-md',
                'text-blue-900',
                'shadow-blue-900',
                'shadow-lg',
                isUser ? 'bg-blue-100' : 'bg-blue-200'
            );

            const messageText = document.createElement('p');
            messageText.textContent = message;

            const messageTime = document.createElement('span');
            messageTime.classList.add('text-xs', 'text-slate-900', 'mt-1', 'block', 'text-right');
            messageTime.textContent = formatTime(new Date());

            messageBubble.appendChild(messageText);
            messageBubble.appendChild(messageTime);
            messageElement.appendChild(messageBubble);
            chatMessages.appendChild(messageElement);

            // Scroll to the bottom of the chat messages
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Event listener for the send button
        sendButton.addEventListener('click', () => {
            const message = messageInput.value.trim();
            if (message) {
                addMessage(message, true); // Add user's message
                messageInput.value = ''; // Clear input field

                // --- Flask Integration Placeholder ---                
                fetch('/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: message }),
                })
                .then(response => response.json())
                .then(data => {
                    // Assuming Flask sends back a response message, e.g., an AI response
                    if (data.reply) {
                        addMessage(data.reply, false); // Add Flask's response
                    }
                })
                .catch((error) => {
                    console.error('Error sending message:', error);
                    addMessage('Error: Could not send message.', false); // Show error to user
                });


                // For demonstration, let's simulate a reply after a short delay
                setTimeout(() => {
                    addMessage("Hello! I received your message. (Simulated reply)", false);
                }, 1000);
            }
        });

        // Event listener for Enter key in the input field
        messageInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                sendButton.click(); // Trigger the send button click
            }
        });

        // Ensure chat scrolls to bottom on initial load
        document.addEventListener('DOMContentLoaded', () => {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        });

    </script>
</body>

</html>